-- MySQL dump 10.15  Distrib 10.0.18-MariaDB, for Linux (x86_64)
--
-- Host: localhost    Database: echo
-- ------------------------------------------------------
-- Server version	10.0.18-MariaDB-log

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Table structure for table `accounts`
--

DROP TABLE IF EXISTS `accounts`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `accounts` (
  `accountId` int(11) NOT NULL,
  `username` varchar(255) NOT NULL,
  `password` varchar(255) NOT NULL,
  `role` enum('admin','doctor','patient') NOT NULL,
  `email` varchar(100) NOT NULL,
  `enabled` tinyint(1) NOT NULL DEFAULT '1',
  `reminderTime` time NOT NULL,
  `notificationEnabled` tinyint(1) NOT NULL DEFAULT '1',
  `notificationMode` enum('email','sms','push') NOT NULL DEFAULT 'email',
  `mobile` varchar(45) DEFAULT NULL,
  `modified` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`accountId`),
  UNIQUE KEY `email_UNIQUE` (`email`),
  UNIQUE KEY `username_UNIQUE` (`username`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `accounts`
--

LOCK TABLES `accounts` WRITE;
/*!40000 ALTER TABLE `accounts` DISABLE KEYS */;
INSERT INTO `accounts` VALUES (1,'nimda','$2a$10$5f3gnmB/Cbe1TjrJhaUvNe6MTT6w87Ckiqyr0j4VxLChMtZFIMHka','admin','admin@hospital.de',1,'18:00:00',1,'email','1337','2015-05-20 11:33:44'),(2,'dr.who','$2a$10$sJyY0IDFFdDW4cIFi6nM5uTGmSu9Tpq6YrbyYSKkg.YA1Ql6LLuIC','doctor','who@dr.who',1,'18:00:00',0,'email','0049123456789','2015-05-20 11:33:51'),(3,'averel','$2a$10$sJyY0IDFFdDW4cIFi6nM5uAjfvA80TQwF9C/mZi4RQjEmP80n6c0i','patient','av@e.rel',1,'10:00:00',0,'email','0049987654321','2015-05-20 11:33:51'),(4,'joedalton','$2a$10$sJyY0IDFFdDW4cIFi6nM5ucCBjsL67Xuash/pKZvv760bApoe9gFe','patient','joe@dalt.on',1,'08:45:00',0,'email','00304525515825','2015-05-20 11:33:51'),(34,'mocha-doc1','$2a$10$RChIG.4tKR8L8pZ7Jsp9Wu79qx/U/aJVywPprBczIVMBHPoX4MPvW','doctor','doc1@mocha-test.de',1,'15:55:00',1,'email','234','2015-05-20 11:34:15'),(35,'mocha-pat1','$2a$10$uu6DeToFFUwHHZhAdOebSOCH8oyp7OagSLf9Br8T62k2UmDyz/WOW','patient','pat1@mocha-test.de',1,'15:55:00',1,'push','345','2015-05-20 11:34:15');
/*!40000 ALTER TABLE `accounts` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,STRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,TRADITIONAL,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `accounts_BUPD` BEFORE UPDATE ON `accounts` FOR EACH ROW
BEGIN
SET new.role = old.role;

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,STRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,TRADITIONAL,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `accounts_BEFORE_DELETE` BEFORE DELETE ON `accounts` FOR EACH ROW
begin

if old.role = 'admin' then
	SELECT count(*) into @count from accounts where role = 'admin';
    if (@count = 1) then
		signal sqlstate '22400' set message_text = 'You are not allowed to delete the last remaining admin account!';
	end if;
end if;

end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Temporary table structure for view `accounts_view`
--

DROP TABLE IF EXISTS `accounts_view`;
/*!50001 DROP VIEW IF EXISTS `accounts_view`*/;
SET @saved_cs_client     = @@character_set_client;
SET character_set_client = utf8;
/*!50001 CREATE TABLE `accounts_view` (
  `accountId` tinyint NOT NULL,
  `username` tinyint NOT NULL,
  `password` tinyint NOT NULL,
  `role` tinyint NOT NULL,
  `email` tinyint NOT NULL,
  `enabled` tinyint NOT NULL,
  `reminderTime` tinyint NOT NULL,
  `notificationEnabled` tinyint NOT NULL,
  `notificationMode` tinyint NOT NULL,
  `mobile` tinyint NOT NULL,
  `modified` tinyint NOT NULL
) ENGINE=MyISAM */;
SET character_set_client = @saved_cs_client;

--
-- Table structure for table `answers`
--

DROP TABLE IF EXISTS `answers`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `answers` (
  `answerId` int(11) NOT NULL AUTO_INCREMENT,
  `questionId` int(11) NOT NULL,
  `text` varchar(100) DEFAULT NULL,
  `value` int(11) DEFAULT NULL,
  PRIMARY KEY (`answerId`),
  KEY `fk.ans.quid_idx` (`questionId`),
  CONSTRAINT `fk.ans.quid` FOREIGN KEY (`questionId`) REFERENCES `questions` (`questionId`) ON DELETE CASCADE ON UPDATE NO ACTION
) ENGINE=InnoDB AUTO_INCREMENT=123 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `answers`
--

LOCK TABLES `answers` WRITE;
/*!40000 ALTER TABLE `answers` DISABLE KEYS */;
INSERT INTO `answers` VALUES (1,1,'I never cough.',0),(2,1,'',1),(3,1,'',2),(4,1,'',3),(5,1,'',4),(6,1,'I cough all the time.',5),(7,2,'I have no phlegm in my chest at all.',0),(8,2,'',1),(9,2,'',2),(10,2,'',3),(11,2,'',4),(12,2,'My chest is completely full of phlegm.',5),(13,3,'My chest does not feel tight at all.',0),(14,3,'',1),(15,3,'',2),(16,3,'',3),(17,3,'',4),(18,3,'My chest feels very tight.',5),(19,4,'When I walk up a hill or one flight of stairs I am not breathless.',0),(20,4,'',1),(21,4,'',2),(22,4,'',3),(23,4,'',4),(24,4,'When I walk up a hill or one flight of stairs I am very breathless.',5),(25,5,'I am not limited doing any activities at home.',0),(26,5,'',1),(27,5,'',2),(28,5,'',3),(29,5,'',4),(30,5,'I am very limited doing activities at home.',5),(31,6,'I am confident leaving my home despite lung condition.',0),(32,6,'',1),(33,6,'',2),(34,6,'',3),(35,6,'',4),(36,6,'I am not at all confident leaving my home because od my lung condition.',5),(37,7,'I sleep soundly.',0),(38,7,'',1),(39,7,'',2),(40,7,'',3),(41,7,'',4),(42,7,'I dont sleep soundly because of my lung condition.',5),(43,8,'I have lots of energy.',0),(44,8,'',1),(45,8,'',2),(46,8,'',3),(47,8,'',4),(48,8,'I have no energy at all.',5),(49,25,'Ok',1),(50,25,'Not Ok',2),(51,26,'Not OK',1),(52,26,'OK',2),(53,27,'never',0),(54,27,'hardly ever',1),(55,27,'a few times',2),(56,27,'several times',3),(57,27,'many times',4),(58,27,'a great many times',5),(59,27,'almost all the time',6),(60,28,'Never',0),(61,28,'hardly ever',1),(62,28,'a few times',2),(63,28,'several times',3),(64,28,'many times',4),(65,28,'a great many times',5),(66,28,'almost all the time',6),(67,29,'Never',0),(68,29,'hardly ever',1),(69,29,'a few times',2),(70,29,'several times',3),(71,29,'many times',4),(72,29,'a great many times',5),(73,29,'almost all the time',6),(74,30,'Never',0),(75,30,'hardly ever',1),(76,30,'a few times',2),(77,30,'several times',3),(78,30,'many times',4),(79,30,'a great many times',5),(80,30,'almost all the time',6),(81,31,'Never',0),(82,31,'hardly ever',1),(83,31,'a few times',2),(84,31,'several times',3),(85,31,'many times',4),(86,31,'a great many times',5),(87,31,'almost all the time',6),(88,32,'Never',0),(89,32,'hardly ever',1),(90,32,'a few times',2),(91,32,'several times',3),(92,32,'many times',4),(93,32,'a great many times',5),(94,32,'almost all the time',6),(95,33,'Never',0),(96,33,'hardly ever',1),(97,33,'a few times',2),(98,33,'several times',3),(99,33,'many times',4),(100,33,'a great many times',5),(101,33,'almost all the time',6),(102,34,'Never',0),(103,34,'hardly ever',1),(104,34,'a few times',2),(105,34,'several times',3),(106,34,'many times',4),(107,34,'a great many times',5),(108,34,'almost all the time',6),(109,35,'Never',0),(110,35,'hardly ever',1),(111,35,'a few times',2),(112,35,'several times',3),(113,35,'many times',4),(114,35,'a great many times',5),(115,35,'almost all the time',6),(116,36,'Never',0),(117,36,'hardly ever',1),(118,36,'a few times',2),(119,36,'several times',3),(120,36,'many times',4),(121,36,'a great many times',5),(122,36,'almost all the time',6);
/*!40000 ALTER TABLE `answers` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `cats`
--

DROP TABLE IF EXISTS `cats`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `cats` (
  `recordId` int(11) NOT NULL AUTO_INCREMENT,
  `patientId` int(11) NOT NULL,
  `diagnoseDate` date DEFAULT NULL,
  `q1` int(11) NOT NULL DEFAULT '-1',
  `q2` int(11) NOT NULL DEFAULT '-1',
  `q3` int(11) NOT NULL DEFAULT '-1',
  `q4` int(11) NOT NULL DEFAULT '-1',
  `q5` int(11) NOT NULL DEFAULT '-1',
  `q6` int(11) NOT NULL DEFAULT '-1',
  `q7` int(11) NOT NULL DEFAULT '-1',
  `q8` int(11) NOT NULL DEFAULT '-1',
  `totalCatscale` int(11) DEFAULT '0',
  `status` enum('baseline','exacerbation') NOT NULL,
  `modified` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`recordId`),
  KEY `catsFKpat_idx` (`patientId`),
  CONSTRAINT `catsFKpat` FOREIGN KEY (`patientId`) REFERENCES `patients` (`patientId`) ON DELETE CASCADE ON UPDATE NO ACTION
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `cats`
--

LOCK TABLES `cats` WRITE;
/*!40000 ALTER TABLE `cats` DISABLE KEYS */;
INSERT INTO `cats` VALUES (1,3,'2015-05-20',1,1,0,0,1,0,1,1,5,'baseline','2015-05-20 11:33:51'),(2,4,'2015-05-20',0,1,0,1,0,1,0,1,4,'exacerbation','2015-05-20 11:33:51');
/*!40000 ALTER TABLE `cats` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,STRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,TRADITIONAL,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `catscale_BINS` BEFORE INSERT ON `cats` FOR EACH ROW
begin
if (new.q1 < 0 OR new.q2 < 0 OR new.q3 < 0 OR new.q4 < 0 OR new.q5 < 0 OR new.q6 < 0 OR new.q7 < 0 OR new.q8 < 0) then
SIGNAL SQLSTATE '22400' SET MESSAGE_TEXT = 'Invalid answer. Answer values have to be in range [0; 5]';
end if;
if (new.q1 > 5 OR new.q2 > 5 OR new.q3 > 5 OR new.q4 > 5 OR new.q5 > 5 OR new.q6 > 5 OR new.q7 > 5 OR new.q8 > 5) then
SIGNAL SQLSTATE '22400' SET MESSAGE_TEXT = 'Invalid answer. Answer values have to be in range [0; 5]';
end if;
if (new.diagnoseDate is null) then set new.diagnoseDate = CURDATE(); end if;
set new.totalCatscale = (new.q1 + new.q2 + new.q3 + new.q4 + new.q5 + new.q6 + new.q7 + new.q8 );
end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,STRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,TRADITIONAL,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `cats_BUPD` BEFORE UPDATE ON `cats` FOR EACH ROW
begin
if (new.q1 < 0 OR new.q2 < 0 OR new.q3 < 0 OR new.q4 < 0 OR new.q5 < 0 OR new.q6 < 0 OR new.q7 < 0 OR new.q8 < 0) then
SIGNAL SQLSTATE '22400' SET MESSAGE_TEXT = 'Invalid answer. Answer values have to be in range [0; 5]';
end if;
if (new.q1 > 5 OR new.q2 > 5 OR new.q3 > 5 OR new.q4 > 5 OR new.q5 > 5 OR new.q6 > 5 OR new.q7 > 5 OR new.q8 > 5) then
SIGNAL SQLSTATE '22400' SET MESSAGE_TEXT = 'Invalid answer. Answer values have to be in range [0; 5]';
end if;
if (new.diagnoseDate is null) then set new.diagnoseDate = CURDATE(); end if;
set new.totalCatscale = (new.q1 + new.q2 + new.q3 + new.q4 + new.q5 + new.q6 + new.q7 + new.q8 );
end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Temporary table structure for view `cats_view`
--

DROP TABLE IF EXISTS `cats_view`;
/*!50001 DROP VIEW IF EXISTS `cats_view`*/;
SET @saved_cs_client     = @@character_set_client;
SET character_set_client = utf8;
/*!50001 CREATE TABLE `cats_view` (
  `recordId` tinyint NOT NULL,
  `patientId` tinyint NOT NULL,
  `diagnoseDate` tinyint NOT NULL,
  `q1` tinyint NOT NULL,
  `q2` tinyint NOT NULL,
  `q3` tinyint NOT NULL,
  `q4` tinyint NOT NULL,
  `q5` tinyint NOT NULL,
  `q6` tinyint NOT NULL,
  `q7` tinyint NOT NULL,
  `q8` tinyint NOT NULL,
  `totalCatscale` tinyint NOT NULL,
  `status` tinyint NOT NULL,
  `modified` tinyint NOT NULL
) ENGINE=MyISAM */;
SET character_set_client = @saved_cs_client;

--
-- Table structure for table `ccqs`
--

DROP TABLE IF EXISTS `ccqs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ccqs` (
  `recordId` int(11) NOT NULL AUTO_INCREMENT,
  `patientId` int(11) NOT NULL,
  `diagnoseDate` date DEFAULT NULL,
  `q1` int(11) NOT NULL DEFAULT '-1',
  `q2` int(11) NOT NULL DEFAULT '-1',
  `q3` int(11) NOT NULL DEFAULT '-1',
  `q4` int(11) NOT NULL DEFAULT '-1',
  `q5` int(11) NOT NULL DEFAULT '-1',
  `q6` int(11) NOT NULL DEFAULT '-1',
  `q7` int(11) NOT NULL DEFAULT '-1',
  `q8` int(11) NOT NULL DEFAULT '-1',
  `q9` int(11) NOT NULL DEFAULT '-1',
  `q10` int(11) NOT NULL DEFAULT '-1',
  `totalCCQScore` float DEFAULT NULL,
  `symptomScore` float DEFAULT NULL,
  `mentalStateScore` float DEFAULT NULL,
  `functionalStateScore` float DEFAULT NULL,
  `status` enum('baseline','exacerbation') NOT NULL,
  `modified` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`recordId`),
  KEY `ccqFKpat_idx` (`patientId`),
  CONSTRAINT `ccqFKpat` FOREIGN KEY (`patientId`) REFERENCES `patients` (`patientId`) ON DELETE CASCADE ON UPDATE NO ACTION
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `ccqs`
--

LOCK TABLES `ccqs` WRITE;
/*!40000 ALTER TABLE `ccqs` DISABLE KEYS */;
INSERT INTO `ccqs` VALUES (1,3,'2015-05-20',1,1,0,1,0,0,0,1,0,1,0.5,0.5,0.5,0.5,'baseline','2015-05-20 11:33:51'),(2,4,'2015-05-20',0,1,0,1,0,1,0,1,0,1,0.5,0.5,0.5,0.5,'exacerbation','2015-05-20 11:33:51');
/*!40000 ALTER TABLE `ccqs` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,STRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,TRADITIONAL,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `ccqs_BINS` BEFORE INSERT ON `ccqs` FOR EACH ROW
BEGIN
if (new.q1 < 0 OR new.q2 < 0 OR new.q3 < 0 OR new.q4 < 0 OR new.q5 < 0 OR new.q6 < 0 OR new.q7 < 0 OR new.q8 < 0 OR new.q9 < 0 OR new.q10 < 0) then
SIGNAL SQLSTATE '22400' SET MESSAGE_TEXT = 'Invalid answer. Answer values have to be in range [0; 6]';
end if;
if (new.q1 > 6 OR new.q2 > 6 OR new.q3 > 6 OR new.q4 > 6 OR new.q5 > 6 OR new.q6 > 6 OR new.q7 > 6 OR new.q8 > 6 OR new.q9 > 6 OR new.q10 > 6) then
SIGNAL SQLSTATE '22400' SET MESSAGE_TEXT = 'Invalid answer. Answer values have to be in range [0; 6]';
end if;

	if (new.diagnoseDate is null) then set new.diagnoseDate = CURDATE(); end if;
	set new.totalCCQScore = (new.q1 + new.q2 + new.q3 + new.q4 + new.q5 + new.q6 + new.q7 + new.q8 + new.q9 + new.q10)/10;
	set new.symptomScore = (new.q1 + new.q2 + new.q5 + new.q6)/4;
	set new.mentalStateScore = (new.q3 + new.q4 )/2;
	set new.functionalStateScore = (new.q7 + new.q8 + new.q9 + new.q10)/4;
end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,STRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,TRADITIONAL,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `ccqs_BUPD` BEFORE UPDATE ON `ccqs` FOR EACH ROW
begin
if (new.q1 < 0 OR new.q2 < 0 OR new.q3 < 0 OR new.q4 < 0 OR new.q5 < 0 OR new.q6 < 0 OR new.q7 < 0 OR new.q8 < 0 OR new.q9 < 0 OR new.q10 < 0) then
SIGNAL SQLSTATE '22400' SET MESSAGE_TEXT = 'Invalid answer. Answer values have to be in range [0; 6]';
end if;
if (new.q1 > 6 OR new.q2 > 6 OR new.q3 > 6 OR new.q4 > 6 OR new.q5 > 6 OR new.q6 > 6 OR new.q7 > 6 OR new.q8 > 6 OR new.q9 > 6 OR new.q10 > 6) then
SIGNAL SQLSTATE '22400' SET MESSAGE_TEXT = 'Invalid answer. Answer values have to be in range [0; 6]';
end if;

if (new.diagnoseDate is null) then set new.diagnoseDate = CURDATE(); end if;

	set new.totalCCQScore = (new.q1 + new.q2 + new.q3 + new.q4 + new.q5 + new.q6 + new.q7 + new.q8 + new.q9 + new.q10)/10;
	set new.symptomScore = (new.q1 + new.q2 + new.q5 + new.q6)/4;
	set new.mentalStateScore = (new.q3 + new.q4 )/2;
	set new.functionalStateScore = (new.q7 + new.q8 + new.q9 + new.q10)/4;
end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Temporary table structure for view `ccqs_view`
--

DROP TABLE IF EXISTS `ccqs_view`;
/*!50001 DROP VIEW IF EXISTS `ccqs_view`*/;
SET @saved_cs_client     = @@character_set_client;
SET character_set_client = utf8;
/*!50001 CREATE TABLE `ccqs_view` (
  `recordId` tinyint NOT NULL,
  `patientId` tinyint NOT NULL,
  `diagnoseDate` tinyint NOT NULL,
  `q1` tinyint NOT NULL,
  `q2` tinyint NOT NULL,
  `q3` tinyint NOT NULL,
  `q4` tinyint NOT NULL,
  `q5` tinyint NOT NULL,
  `q6` tinyint NOT NULL,
  `q7` tinyint NOT NULL,
  `q8` tinyint NOT NULL,
  `q9` tinyint NOT NULL,
  `q10` tinyint NOT NULL,
  `totalCCQScore` tinyint NOT NULL,
  `symptomScore` tinyint NOT NULL,
  `mentalStateScore` tinyint NOT NULL,
  `functionalStateScore` tinyint NOT NULL,
  `status` tinyint NOT NULL,
  `modified` tinyint NOT NULL
) ENGINE=MyISAM */;
SET character_set_client = @saved_cs_client;

--
-- Table structure for table `charlsons`
--

DROP TABLE IF EXISTS `charlsons`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `charlsons` (
  `recordId` int(11) NOT NULL AUTO_INCREMENT,
  `patientId` int(11) NOT NULL,
  `diagnoseDate` date DEFAULT NULL,
  `myocardialInfarction` tinyint(1) DEFAULT '0',
  `congestiveHeartFailure` tinyint(1) DEFAULT '0',
  `peripheralVascularDisease` tinyint(1) DEFAULT '0',
  `cerebrovascularDisease` tinyint(1) DEFAULT '0',
  `dementia` tinyint(1) DEFAULT '0',
  `chronicPulmonaryDiasease` tinyint(1) DEFAULT '0',
  `connectiveTissueDisease` tinyint(1) DEFAULT '0',
  `ulcerDisease` tinyint(1) DEFAULT '0',
  `liverDiseaseMild` tinyint(1) DEFAULT '0',
  `diabetes` tinyint(1) DEFAULT '0',
  `hemiplegia` tinyint(1) DEFAULT '0',
  `renalDiseaseModerateOrSevere` tinyint(1) DEFAULT '0',
  `diabetesWithEndOrganDamage` tinyint(1) DEFAULT '0',
  `anyTumor` tinyint(1) DEFAULT '0',
  `leukemia` tinyint(1) DEFAULT '0',
  `malignantLymphoma` tinyint(1) DEFAULT '0',
  `liverDiseaseModerateOrSevere` tinyint(1) DEFAULT '0',
  `metastaticSolidMalignancy` tinyint(1) DEFAULT '0',
  `aids` tinyint(1) DEFAULT '0',
  `noConditionAvailable` tinyint(1) DEFAULT '0',
  `totalCharlson` int(11) DEFAULT '0',
  `modified` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`recordId`),
  KEY `charFKpat_idx` (`patientId`),
  CONSTRAINT `charFKpat` FOREIGN KEY (`patientId`) REFERENCES `patients` (`patientId`) ON DELETE CASCADE ON UPDATE NO ACTION
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `charlsons`
--

LOCK TABLES `charlsons` WRITE;
/*!40000 ALTER TABLE `charlsons` DISABLE KEYS */;
INSERT INTO `charlsons` VALUES (1,3,'2015-05-20',0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,'2015-05-20 11:33:51'),(2,4,'2015-05-20',1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,37,'2015-05-20 11:33:51');
/*!40000 ALTER TABLE `charlsons` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,STRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,TRADITIONAL,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `Charlson_BINS` BEFORE INSERT ON `charlsons` FOR EACH ROW
begin
	declare sum int;
if (new.diagnoseDate is null) then set new.diagnoseDate = CURDATE(); end if;

	set sum = 0;

		if (new.myocardialInfarction > 0) then
			set sum := sum + 1;
			set new.myocardialInfarction = 1;
		end if;
		if (new.congestiveHeartFailure > 0) then
			set sum := sum + 1;
			set new.congestiveHeartFailure = 1;
		end if;
		if (new.peripheralVascularDisease > 0) then
			set sum := sum + 1;
			set new.peripheralVascularDisease = 1;
		end if;
		if (new.cerebrovascularDisease > 0) then
			set sum := sum + 1;
			set new.cerebrovascularDisease = 1;
		end if;
		if (new.dementia > 0) then
			set new.dementia = 1;
			set sum := sum + 1;
		end if;
		if (new.chronicPulmonaryDiasease > 0) then
			set sum := sum + 1;
			set new.chronicPulmonaryDiasease = 1;
		end if;
		if (new.connectiveTissueDisease > 0) then
			set sum := sum + 1;
			set new.connectiveTissueDisease = 1;
		end if;
		if (new.ulcerDisease > 0) then
			set sum := sum + 1;
			set new.ulcerDisease = 1;
		end if;
		if (new.liverDiseaseMild > 0) then
			set sum := sum + 1;
			set new.liverDiseaseMild = 1;
		end if;
		if (new.diabetes > 0) then
			set sum := sum + 1;
			set new.diabetes = 1;
		end if;
		if (new.hemiplegia > 0) then
			set sum := sum + 2;
			set new.hemiplegia = 1;
		end if;
		if (new.renalDiseaseModerateOrSevere > 0) then
			set sum := sum + 2;
			set new.renalDiseaseModerateOrSevere = 1;
		end if;
		if (new.diabetesWithEndOrganDamage > 0) then
			set sum := sum + 2;
			set new.diabetesWithEndOrganDamage = 1;
		end if;
		if (new.anyTumor > 0) then
			set sum := sum + 2;
			set new.anyTumor = 1;
		end if;
		if (new.leukemia > 0) then
			set sum := sum + 2;
			set new.leukemia = 1;
		end if;
		if (new.malignantLymphoma > 0) then
			set sum := sum + 2;
			set new.malignantLymphoma = 1;
		end if;
		if (new.liverDiseaseModerateOrSevere > 0) then
			set sum := sum + 3;
			set new.liverDiseaseModerateOrSevere = 1;
		end if;
		if (new.metastaticSolidMalignancy > 0) then
			set sum := sum + 6;
			set new.metastaticSolidMalignancy = 1;
		end if;
		if (new.aids > 0) then
			set sum := sum + 6;
			set new.aids = 1;
		end if;
		set new.totalCharlson = sum;	
	if (new.noConditionAvailable = 1 && new.totalCharlson > 0) then
		signal sqlstate '22400' set message_text = 'Total Score is not 0, but No Condition has been selected';
	end if;
	
end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,STRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,TRADITIONAL,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `charlsons_BUPD` BEFORE UPDATE ON `charlsons` FOR EACH ROW
begin
	declare sum int;

	if (new.diagnoseDate is null) then set new.diagnoseDate = CURDATE(); end if;

	set sum = 0;
		if (new.myocardialInfarction > 0) then
			set sum := sum + 1;
			set new.myocardialInfarction = 1;
		end if;
		if (new.congestiveHeartFailure > 0) then
			set sum := sum + 1;
			set new.congestiveHeartFailure = 1;
		end if;
		if (new.peripheralVascularDisease > 0) then
			set sum := sum + 1;
			set new.peripheralVascularDisease = 1;
		end if;
		if (new.cerebrovascularDisease > 0) then
			set sum := sum + 1;
			set new.cerebrovascularDisease = 1;
		end if;
		if (new.dementia > 0) then
			set new.dementia = 1;
			set sum := sum + 1;
		end if;
		if (new.chronicPulmonaryDiasease > 0) then
			set sum := sum + 1;
			set new.chronicPulmonaryDiasease = 1;
		end if;
		if (new.connectiveTissueDisease > 0) then
			set sum := sum + 1;
			set new.connectiveTissueDisease = 1;
		end if;
		if (new.ulcerDisease > 0) then
			set sum := sum + 1;
			set new.ulcerDisease = 1;
		end if;
		if (new.liverDiseaseMild > 0) then
			set sum := sum + 1;
			set new.liverDiseaseMild = 1;
		end if;
		if (new.diabetes > 0) then
			set sum := sum + 1;
			set new.diabetes = 1;
		end if;
		if (new.hemiplegia > 0) then
			set sum := sum + 2;
			set new.hemiplegia = 1;
		end if;
		if (new.renalDiseaseModerateOrSevere > 0) then
			set sum := sum + 2;
			set new.renalDiseaseModerateOrSevere = 1;
		end if;
		if (new.diabetesWithEndOrganDamage > 0) then
			set sum := sum + 2;
			set new.diabetesWithEndOrganDamage = 1;
		end if;
		if (new.anyTumor > 0) then
			set sum := sum + 2;
			set new.anyTumor = 1;
		end if;
		if (new.leukemia > 0) then
			set sum := sum + 2;
			set new.leukemia = 1;
		end if;
		if (new.malignantLymphoma > 0) then
			set sum := sum + 2;
			set new.malignantLymphoma = 1;
		end if;
		if (new.liverDiseaseModerateOrSevere > 0) then
			set sum := sum + 3;
			set new.liverDiseaseModerateOrSevere = 1;
		end if;
		if (new.metastaticSolidMalignancy > 0) then
			set sum := sum + 6;
			set new.metastaticSolidMalignancy = 1;
		end if;
		if (new.aids > 0) then
			set sum := sum + 6;
			set new.aids = 1;
		end if;
		set new.totalCharlson = sum;
	if (new.noConditionAvailable = 1 && new.totalCharlson > 0) then
		signal sqlstate '22400' set message_text = 'Total Score is not 0, but No Condition has been selected';
	end if;
end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Temporary table structure for view `charlsons_view`
--

DROP TABLE IF EXISTS `charlsons_view`;
/*!50001 DROP VIEW IF EXISTS `charlsons_view`*/;
SET @saved_cs_client     = @@character_set_client;
SET character_set_client = utf8;
/*!50001 CREATE TABLE `charlsons_view` (
  `recordId` tinyint NOT NULL,
  `patientId` tinyint NOT NULL,
  `diagnoseDate` tinyint NOT NULL,
  `myocardialInfarction` tinyint NOT NULL,
  `congestiveHeartFailure` tinyint NOT NULL,
  `peripheralVascularDisease` tinyint NOT NULL,
  `cerebrovascularDisease` tinyint NOT NULL,
  `dementia` tinyint NOT NULL,
  `chronicPulmonaryDiasease` tinyint NOT NULL,
  `connectiveTissueDisease` tinyint NOT NULL,
  `ulcerDisease` tinyint NOT NULL,
  `liverDiseaseMild` tinyint NOT NULL,
  `diabetes` tinyint NOT NULL,
  `hemiplegia` tinyint NOT NULL,
  `renalDiseaseModerateOrSevere` tinyint NOT NULL,
  `diabetesWithEndOrganDamage` tinyint NOT NULL,
  `anyTumor` tinyint NOT NULL,
  `leukemia` tinyint NOT NULL,
  `malignantLymphoma` tinyint NOT NULL,
  `liverDiseaseModerateOrSevere` tinyint NOT NULL,
  `metastaticSolidMalignancy` tinyint NOT NULL,
  `aids` tinyint NOT NULL,
  `noConditionAvailable` tinyint NOT NULL,
  `totalCharlson` tinyint NOT NULL,
  `modified` tinyint NOT NULL
) ENGINE=MyISAM */;
SET character_set_client = @saved_cs_client;

--
-- Table structure for table `dailyReports`
--

DROP TABLE IF EXISTS `dailyReports`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `dailyReports` (
  `recordId` int(11) NOT NULL AUTO_INCREMENT,
  `patientId` int(11) NOT NULL,
  `date` date DEFAULT NULL,
  `q1` tinyint(1) NOT NULL,
  `q2` tinyint(1) NOT NULL,
  `q3` tinyint(1) NOT NULL,
  `q4` tinyint(1) NOT NULL,
  `q5` tinyint(1) NOT NULL,
  `q1a` tinyint(1) DEFAULT '0',
  `q1b` tinyint(1) DEFAULT '0',
  `q1c` tinyint(1) DEFAULT '0',
  `q3a` tinyint(1) DEFAULT '0',
  `q3b` tinyint(1) DEFAULT '0',
  `q3c` tinyint(1) DEFAULT '0',
  `satO2` float DEFAULT '0',
  `walkingDist` float DEFAULT '0',
  `temperature` float DEFAULT '0',
  `pefr` float DEFAULT '0',
  `heartRate` float DEFAULT '0',
  `loc` point DEFAULT NULL,
  `modified` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`recordId`),
  KEY `repFKpat_idx` (`patientId`),
  CONSTRAINT `repFKpat` FOREIGN KEY (`patientId`) REFERENCES `patients` (`patientId`) ON DELETE CASCADE ON UPDATE NO ACTION
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `dailyReports`
--

LOCK TABLES `dailyReports` WRITE;
/*!40000 ALTER TABLE `dailyReports` DISABLE KEYS */;
INSERT INTO `dailyReports` VALUES (1,3,'2015-05-20',1,0,0,0,1,0,1,0,0,0,0,40,2500,36,40,95,'\0\0\0\0\0\0\0\0\0\0\0\0\0\"@\0\0\0\0\0€H@','2015-05-20 11:33:51'),(2,4,'2015-05-20',1,0,1,0,1,0,1,0,1,0,1,54,8435,38,42,78,'\0\0\0\0\0\0\0\0\0\0\0\0\0\"@\0\0\0\0\0€H@','2015-05-20 11:33:51');
/*!40000 ALTER TABLE `dailyReports` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,STRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,TRADITIONAL,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `dailyReport_BINS` BEFORE INSERT ON `dailyReports` FOR EACH ROW
Begin

if (new.date is null) then set new.date = CURDATE(); end if;
end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,STRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,TRADITIONAL,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `dailyReports_BUPD` BEFORE UPDATE ON `dailyReports` FOR EACH ROW
begin
if (new.date is null) then set new.date = CURDATE(); end if;
end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Temporary table structure for view `dailyReports_view`
--

DROP TABLE IF EXISTS `dailyReports_view`;
/*!50001 DROP VIEW IF EXISTS `dailyReports_view`*/;
SET @saved_cs_client     = @@character_set_client;
SET character_set_client = utf8;
/*!50001 CREATE TABLE `dailyReports_view` (
  `recordId` tinyint NOT NULL,
  `patientId` tinyint NOT NULL,
  `date` tinyint NOT NULL,
  `q1` tinyint NOT NULL,
  `q2` tinyint NOT NULL,
  `q3` tinyint NOT NULL,
  `q4` tinyint NOT NULL,
  `q5` tinyint NOT NULL,
  `q1a` tinyint NOT NULL,
  `q1b` tinyint NOT NULL,
  `q1c` tinyint NOT NULL,
  `q3a` tinyint NOT NULL,
  `q3b` tinyint NOT NULL,
  `q3c` tinyint NOT NULL,
  `satO2` tinyint NOT NULL,
  `walkingDist` tinyint NOT NULL,
  `temperature` tinyint NOT NULL,
  `pefr` tinyint NOT NULL,
  `heartRate` tinyint NOT NULL,
  `loc` tinyint NOT NULL,
  `modified` tinyint NOT NULL
) ENGINE=MyISAM */;
SET character_set_client = @saved_cs_client;

--
-- Table structure for table `deaths`
--

DROP TABLE IF EXISTS `deaths`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `deaths` (
  `patientId` int(11) NOT NULL,
  `date` datetime DEFAULT NULL,
  `cardiovascular` tinyint(1) DEFAULT '0',
  `respiratory` tinyint(1) DEFAULT '0',
  `infectious_disease` tinyint(1) DEFAULT '0',
  `malignancy` tinyint(1) DEFAULT '0',
  `other` varchar(255) DEFAULT NULL,
  `modified` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`patientId`),
  CONSTRAINT `deathFKpat` FOREIGN KEY (`patientId`) REFERENCES `patients` (`patientId`) ON DELETE CASCADE ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `deaths`
--

LOCK TABLES `deaths` WRITE;
/*!40000 ALTER TABLE `deaths` DISABLE KEYS */;
/*!40000 ALTER TABLE `deaths` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,STRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,TRADITIONAL,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `deaths_BINS` BEFORE INSERT ON `deaths` FOR EACH ROW
begin
if (new.date is null) then set new.date = CURDATE(); end if;
end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Temporary table structure for view `deaths_view`
--

DROP TABLE IF EXISTS `deaths_view`;
/*!50001 DROP VIEW IF EXISTS `deaths_view`*/;
SET @saved_cs_client     = @@character_set_client;
SET character_set_client = utf8;
/*!50001 CREATE TABLE `deaths_view` (
  `patientId` tinyint NOT NULL,
  `date` tinyint NOT NULL,
  `cardiovascular` tinyint NOT NULL,
  `respiratory` tinyint NOT NULL,
  `infectious_disease` tinyint NOT NULL,
  `malignancy` tinyint NOT NULL,
  `other` tinyint NOT NULL,
  `modified` tinyint NOT NULL
) ENGINE=MyISAM */;
SET character_set_client = @saved_cs_client;

--
-- Table structure for table `devices`
--

DROP TABLE IF EXISTS `devices`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `devices` (
  `accountId` int(11) NOT NULL,
  `deviceId` varchar(255) NOT NULL,
  `modified` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`accountId`,`deviceId`),
  UNIQUE KEY `deviceId_UNIQUE` (`deviceId`),
  CONSTRAINT `devicesFKacc` FOREIGN KEY (`accountId`) REFERENCES `accounts` (`accountId`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `devices`
--

LOCK TABLES `devices` WRITE;
/*!40000 ALTER TABLE `devices` DISABLE KEYS */;
/*!40000 ALTER TABLE `devices` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `notifications`
--

DROP TABLE IF EXISTS `notifications`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `notifications` (
  `notificationId` int(11) NOT NULL AUTO_INCREMENT,
  `accountId` int(11) NOT NULL,
  `date` datetime DEFAULT NULL,
  `type` int(11) NOT NULL,
  `subjectsAccount` int(11) DEFAULT NULL,
  `modified` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`notificationId`),
  KEY `notFKpatient_idx` (`accountId`),
  KEY `notFKsubject_idx` (`subjectsAccount`),
  CONSTRAINT `notFKpatient` FOREIGN KEY (`accountId`) REFERENCES `accounts` (`accountId`) ON DELETE CASCADE ON UPDATE NO ACTION,
  CONSTRAINT `notFKsubject` FOREIGN KEY (`subjectsAccount`) REFERENCES `accounts` (`accountId`) ON DELETE CASCADE ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `notifications`
--

LOCK TABLES `notifications` WRITE;
/*!40000 ALTER TABLE `notifications` DISABLE KEYS */;
/*!40000 ALTER TABLE `notifications` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,STRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,TRADITIONAL,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `notifications_BINS` BEFORE INSERT ON `notifications` FOR EACH ROW
begin
if (new.date is null) then set new.date = CURDATE(); end if;
end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Temporary table structure for view `notifications_view`
--

DROP TABLE IF EXISTS `notifications_view`;
/*!50001 DROP VIEW IF EXISTS `notifications_view`*/;
SET @saved_cs_client     = @@character_set_client;
SET character_set_client = utf8;
/*!50001 CREATE TABLE `notifications_view` (
  `notificationId` tinyint NOT NULL,
  `accountId` tinyint NOT NULL,
  `date` tinyint NOT NULL,
  `type` tinyint NOT NULL,
  `subjectsAccount` tinyint NOT NULL,
  `message` tinyint NOT NULL,
  `modified` tinyint NOT NULL
) ENGINE=MyISAM */;
SET character_set_client = @saved_cs_client;

--
-- Table structure for table `patients`
--

DROP TABLE IF EXISTS `patients`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `patients` (
  `patientId` int(11) NOT NULL,
  `doctorId` int(11) NOT NULL,
  `firstName` varchar(50) NOT NULL,
  `lastName` varchar(50) NOT NULL,
  `secondName` varchar(50) DEFAULT NULL,
  `socialId` varchar(20) NOT NULL,
  `sex` tinyint(1) NOT NULL,
  `dateOfBirth` date NOT NULL,
  `firstDiagnoseDate` date NOT NULL,
  `fullAddress` varchar(255) NOT NULL,
  `landline` varchar(50) DEFAULT NULL,
  `fileId` varchar(45) NOT NULL,
  `modified` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`patientId`),
  UNIQUE KEY `socialId_UNIQUE` (`socialId`),
  UNIQUE KEY `fileId_UNIQUE` (`fileId`),
  KEY `fkDoctor_idx` (`doctorId`),
  CONSTRAINT `fkDoctor` FOREIGN KEY (`doctorId`) REFERENCES `accounts` (`accountId`) ON UPDATE NO ACTION,
  CONSTRAINT `fkPatient` FOREIGN KEY (`patientId`) REFERENCES `accounts` (`accountId`) ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `patients`
--

LOCK TABLES `patients` WRITE;
/*!40000 ALTER TABLE `patients` DISABLE KEYS */;
INSERT INTO `patients` VALUES (3,2,'averel','test','','12345',1,'2015-05-20','2015-05-20','abc 123','00493654646465432','2','2015-05-20 11:33:51'),(4,2,'joe','dalton','john','234234',1,'2015-05-20','2015-05-20','cba 321','0030231315648','1','2015-05-20 11:33:51'),(35,34,'Patti','Patient','Pat','1337ABC123-mocha',1,'1987-05-07','2011-11-23','Unter den Linden 13, Berlin, Germany','030123456','mocha-unique-id','2015-05-20 11:34:15');
/*!40000 ALTER TABLE `patients` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,STRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,TRADITIONAL,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `patients_BINS` BEFORE INSERT ON `patients` FOR EACH ROW
begin
declare doc_role varchar(10);
declare pat_role varchar(10);

SET doc_role = (SELECT role FROM accounts WHERE accountId = new.doctorId);
if (doc_role != 'doctor') then
SIGNAL SQLSTATE '22400' SET MESSAGE_TEXT = 'Account selected as doctor, isnt a doctors account';
end if;

SET pat_role = (SELECT role FROM accounts WHERE accountId = new.patientId);
if (pat_role != 'patient') then
SIGNAL SQLSTATE '22400' SET MESSAGE_TEXT = 'Account isnt a Patient';
end if;

end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,STRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,TRADITIONAL,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `patients_BUPD` BEFORE UPDATE ON `patients` FOR EACH ROW
begin
declare doc_role varchar(10);
declare pat_role varchar(10);

SET doc_role = (SELECT role FROM accounts WHERE accountId = new.doctorId);
if (doc_role != 'doctor') then
SIGNAL SQLSTATE '22400' SET MESSAGE_TEXT = 'Account selected as doctor, isnt a doctors account';
end if;

SET pat_role = (SELECT role FROM accounts WHERE accountId = new.patientId);
if (pat_role != 'patient') then
SIGNAL SQLSTATE '22400' SET MESSAGE_TEXT = 'Account isnt a Patient';
end if;

end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Temporary table structure for view `patients_view`
--

DROP TABLE IF EXISTS `patients_view`;
/*!50001 DROP VIEW IF EXISTS `patients_view`*/;
SET @saved_cs_client     = @@character_set_client;
SET character_set_client = utf8;
/*!50001 CREATE TABLE `patients_view` (
  `patientId` tinyint NOT NULL,
  `doctorId` tinyint NOT NULL,
  `firstName` tinyint NOT NULL,
  `lastName` tinyint NOT NULL,
  `secondName` tinyint NOT NULL,
  `socialId` tinyint NOT NULL,
  `sex` tinyint NOT NULL,
  `dateOfBirth` tinyint NOT NULL,
  `firstDiagnoseDate` tinyint NOT NULL,
  `fileId` tinyint NOT NULL,
  `fullAddress` tinyint NOT NULL,
  `landline` tinyint NOT NULL,
  `enabled` tinyint NOT NULL,
  `email` tinyint NOT NULL,
  `mobile` tinyint NOT NULL,
  `modified` tinyint NOT NULL,
  `severity` tinyint NOT NULL
) ENGINE=MyISAM */;
SET character_set_client = @saved_cs_client;

--
-- Table structure for table `perm_roles_procedures`
--

DROP TABLE IF EXISTS `perm_roles_procedures`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `perm_roles_procedures` (
  `role` varchar(45) NOT NULL,
  `procedure_obj` varchar(45) NOT NULL,
  PRIMARY KEY (`role`,`procedure_obj`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `perm_roles_procedures`
--

LOCK TABLES `perm_roles_procedures` WRITE;
/*!40000 ALTER TABLE `perm_roles_procedures` DISABLE KEYS */;
INSERT INTO `perm_roles_procedures` VALUES ('admin','accountsCreate'),('admin','accountsDelete'),('admin','accountsUpdate'),('admin','deviceAdd'),('admin','deviceRemove'),('admin','patientsCreate'),('admin','patientsDelete'),('admin','patientsRessourceUpdate'),('doctor','accountsCreate'),('doctor','accountsUpdate'),('doctor','catCreate'),('doctor','catUpdate'),('doctor','ccqCreate'),('doctor','ccqUpdate'),('doctor','charlsonCreate'),('doctor','charlsonUpdate'),('doctor','deathCreate'),('doctor','deathDelete'),('doctor','deathGet'),('doctor','deathUpdate'),('doctor','deleteExamRecord'),('doctor','deviceAdd'),('doctor','deviceRemove'),('doctor','listExams'),('doctor','listSingleExam'),('doctor','patientsCreate'),('doctor','patientsDelete'),('doctor','patientsRessourceUpdate'),('doctor','readingsCreate'),('doctor','readingsUpdate'),('doctor','reportCreate'),('doctor','reportDelete'),('doctor','reportList'),('doctor','reportListOne'),('doctor','reportUpdate'),('doctor','severityCreate'),('doctor','treatmentCreate'),('doctor','treatmentUpdate'),('patient','accountsUpdate'),('patient','deviceAdd'),('patient','deviceRemove'),('patient','reportCreate'),('patient','reportDelete'),('patient','reportList'),('patient','reportListOne'),('patient','reportUpdate');
/*!40000 ALTER TABLE `perm_roles_procedures` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `perm_roles_views`
--

DROP TABLE IF EXISTS `perm_roles_views`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `perm_roles_views` (
  `role` varchar(45) NOT NULL,
  `view_obj` varchar(45) NOT NULL,
  PRIMARY KEY (`role`,`view_obj`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `perm_roles_views`
--

LOCK TABLES `perm_roles_views` WRITE;
/*!40000 ALTER TABLE `perm_roles_views` DISABLE KEYS */;
INSERT INTO `perm_roles_views` VALUES ('admin','accounts_view'),('admin','notifications_view'),('admin','patients_view'),('doctor','accounts_view'),('doctor','notifications_view'),('doctor','patients_view'),('patient','accounts_view'),('patient','notifications_view');
/*!40000 ALTER TABLE `perm_roles_views` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `questions`
--

DROP TABLE IF EXISTS `questions`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `questions` (
  `questionId` int(11) NOT NULL AUTO_INCREMENT,
  `category` varchar(45) NOT NULL,
  `type` varchar(45) NOT NULL,
  `text` varchar(45) DEFAULT NULL,
  `active` tinyint(1) NOT NULL DEFAULT '1',
  `label` varchar(45) DEFAULT NULL,
  PRIMARY KEY (`questionId`)
) ENGINE=InnoDB AUTO_INCREMENT=37 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `questions`
--

LOCK TABLES `questions` WRITE;
/*!40000 ALTER TABLE `questions` DISABLE KEYS */;
INSERT INTO `questions` VALUES (1,'cat','radio','',1,'q1'),(2,'cat','radio','',1,'q2'),(3,'cat','radio','',1,'q3'),(4,'cat','radio','',1,'q4'),(5,'cat','radio','',1,'q5'),(6,'cat','radio','',1,'q6'),(7,'cat','radio','',1,'q7'),(8,'cat','radio','',1,'q8'),(9,'daily','check','Did your shortness of breath increase?',1,'q1'),(10,'daily','check','Did your cough increase?',1,'q2'),(11,'daily','check','Did your sputum change?',1,'q3'),(12,'daily','check','Did you have chest pain or discomfort?',1,'q4'),(13,'daily','check','Did you take the same medications? Or increas',1,'q5'),(14,'daily','check','Can you do the daily work you did before?',1,'q1a'),(15,'daily','check','Can you support yourself (go to toilet, showe',1,'q1b'),(16,'daily','check','Can you walk?',1,'q1c'),(17,'daily','check','Is your sputum yellow?',1,'q3a'),(18,'daily','check','Is it green?',1,'q3b'),(19,'daily','check','Or bloody?',1,'q3c'),(20,'daily','mixed','SatoO2?',1,'satO2'),(21,'daily','mixed','Heartrate?',1,'heartRate'),(22,'daily','mixed','Temperature?',1,'temperature'),(23,'daily','mixed','PETR?',1,'petr'),(24,'daily','mixed','Walking Distance?',1,'walkingDist'),(25,'daily','radio','How do you feel right now?',1,NULL),(26,'daily','radio','How did you feel yesterday?',1,NULL),(27,'ccq','radio','Short of breath at rest?',1,NULL),(28,'ccq','radio','Short of breath doing physical activities?',1,NULL),(29,'ccq','radio','Concerned about getting a cold or your breath',1,NULL),(30,'ccq','radio','Depressed (down) because of your breathing pr',1,NULL),(31,'ccq','radio','During the past week, did you cough?',1,NULL),(32,'ccq','radio','During the past week, did you produce phlegm?',1,NULL),(33,'ccq','radio','Limited activities due to: Strenuous physical',1,NULL),(34,'ccq','radio','Limited activities due to: Moderate physical ',1,NULL),(35,'ccq','radio','Limited activities due to:Daily activities at',1,NULL),(36,'ccq','radio','Limited activities due to:Social activities?',1,NULL);
/*!40000 ALTER TABLE `questions` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `readings`
--

DROP TABLE IF EXISTS `readings`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `readings` (
  `recordId` int(11) NOT NULL AUTO_INCREMENT,
  `patientId` int(11) NOT NULL,
  `diagnoseDate` date DEFAULT NULL,
  `status` enum('baseline','exacerbation') NOT NULL,
  `weight` int(11) DEFAULT NULL,
  `height` int(11) DEFAULT NULL,
  `pxy` int(11) DEFAULT NULL,
  `mmrc` int(11) DEFAULT NULL,
  `smoker` int(11) DEFAULT NULL,
  `notes` text,
  `fev1` float DEFAULT NULL,
  `fev1_pro` float DEFAULT NULL,
  `fvc` float DEFAULT NULL,
  `fvc_pro` float DEFAULT NULL,
  `fev1_fvc` float DEFAULT NULL,
  `rv` float DEFAULT NULL,
  `rv_pro` float DEFAULT NULL,
  `tlc` float DEFAULT NULL,
  `tlc_pro` float DEFAULT NULL,
  `rv_tlc` float DEFAULT NULL,
  `satO2_pro` float DEFAULT NULL,
  `dlco_pro` float DEFAULT NULL,
  `pao2` float DEFAULT NULL,
  `paco2` float DEFAULT NULL,
  `hco3` float DEFAULT NULL,
  `pH` float DEFAULT NULL,
  `fvc_pre` float DEFAULT NULL,
  `fvc_pre_pro` float DEFAULT NULL,
  `fev1_pre` float DEFAULT NULL,
  `fev1_pre_pro` float DEFAULT NULL,
  `fev1_fvc_pre` float DEFAULT NULL,
  `fef25_75_pre_pro` float DEFAULT NULL,
  `pef_pre_pro` float DEFAULT NULL,
  `tlc_pre` float DEFAULT NULL,
  `tlc_pre_pro` float DEFAULT NULL,
  `frc_pre` float DEFAULT NULL,
  `frc_pre_pro` float DEFAULT NULL,
  `rv_pre` float DEFAULT NULL,
  `rv_pre_pro` float DEFAULT NULL,
  `kco_pro` float DEFAULT NULL,
  `hematocrit` float DEFAULT NULL,
  `fvc_post` float DEFAULT NULL,
  `del_fvc_pro` float DEFAULT NULL,
  `fev1_post` float DEFAULT NULL,
  `del_fev1_post` float DEFAULT NULL,
  `del_fef25_75_pro` float DEFAULT NULL,
  `del_pef_pro` float DEFAULT NULL,
  `modified` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`recordId`),
  KEY `readFKpat_idx` (`patientId`),
  CONSTRAINT `readFKpat` FOREIGN KEY (`patientId`) REFERENCES `patients` (`patientId`) ON DELETE CASCADE ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `readings`
--

LOCK TABLES `readings` WRITE;
/*!40000 ALTER TABLE `readings` DISABLE KEYS */;
/*!40000 ALTER TABLE `readings` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,STRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,TRADITIONAL,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `readings_BINS` BEFORE INSERT ON `readings` FOR EACH ROW
begin
if (new.mmrc < 0 or new.mmrc > 4) then 
SIGNAL SQLSTATE '22400' SET MESSAGE_TEXT = 'Invalid value for mmrc. Value has to be in [0:4]';
end if;
if (new.smoker < 0 or new.smoker > 2) then 
SIGNAL SQLSTATE '22400' SET MESSAGE_TEXT = 'Invalid value for smoker. Use 0 for nonsmoker, 1 for smoker and 2 for ex-smoker.';
end if;
if (new.diagnoseDate is null) then set new.diagnoseDate = CURDATE(); end if;
end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,STRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,TRADITIONAL,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `readings_BUPD` BEFORE UPDATE ON `readings` FOR EACH ROW
begin
if (new.mmrc < 0 or new.mmrc > 4) then 
SIGNAL SQLSTATE '22400' SET MESSAGE_TEXT = 'Invalid value for mmrc. Value has to be in [0:4]';
end if;
if (new.smoker < 0 or new.smoker > 2) then 
SIGNAL SQLSTATE '22400' SET MESSAGE_TEXT = 'Invalid value for smoker. Use 0 for nonsmoker, 1 for smoker and 2 for ex-smoker.';
end if;
if (new.diagnoseDate is null) then set new.diagnoseDate = CURDATE(); end if;
end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Temporary table structure for view `readings_view`
--

DROP TABLE IF EXISTS `readings_view`;
/*!50001 DROP VIEW IF EXISTS `readings_view`*/;
SET @saved_cs_client     = @@character_set_client;
SET character_set_client = utf8;
/*!50001 CREATE TABLE `readings_view` (
  `patientId` tinyint NOT NULL,
  `diagnoseDate` tinyint NOT NULL,
  `weight` tinyint NOT NULL,
  `height` tinyint NOT NULL,
  `pxy` tinyint NOT NULL,
  `fev1` tinyint NOT NULL,
  `fev1_pro` tinyint NOT NULL,
  `fvc` tinyint NOT NULL,
  `fvc_pro` tinyint NOT NULL,
  `fev1_fvc` tinyint NOT NULL,
  `rv` tinyint NOT NULL,
  `rv_pro` tinyint NOT NULL,
  `tlc` tinyint NOT NULL,
  `tlc_pro` tinyint NOT NULL,
  `rv_tlc` tinyint NOT NULL,
  `satO2_pro` tinyint NOT NULL,
  `dlco_pro` tinyint NOT NULL,
  `pao2` tinyint NOT NULL,
  `paco2` tinyint NOT NULL,
  `hco3` tinyint NOT NULL,
  `pH` tinyint NOT NULL,
  `fvc_pre` tinyint NOT NULL,
  `fvc_pre_pro` tinyint NOT NULL,
  `fev1_pre` tinyint NOT NULL,
  `fev1_pre_pro` tinyint NOT NULL,
  `fev1_fvc_pre` tinyint NOT NULL,
  `fef25_75_pre_pro` tinyint NOT NULL,
  `pef_pre_pro` tinyint NOT NULL,
  `tlc_pre` tinyint NOT NULL,
  `tlc_pre_pro` tinyint NOT NULL,
  `frc_pre` tinyint NOT NULL,
  `frc_pre_pro` tinyint NOT NULL,
  `rv_pre` tinyint NOT NULL,
  `rv_pre_pro` tinyint NOT NULL,
  `kco_pro` tinyint NOT NULL,
  `hematocrit` tinyint NOT NULL,
  `status` tinyint NOT NULL,
  `fvc_post` tinyint NOT NULL,
  `del_fvc_pro` tinyint NOT NULL,
  `fev1_post` tinyint NOT NULL,
  `del_fev1_post` tinyint NOT NULL,
  `del_fef25_75_pro` tinyint NOT NULL,
  `del_pef_pro` tinyint NOT NULL,
  `mmrc` tinyint NOT NULL,
  `smoker` tinyint NOT NULL,
  `notes` tinyint NOT NULL,
  `recordId` tinyint NOT NULL,
  `modified` tinyint NOT NULL
) ENGINE=MyISAM */;
SET character_set_client = @saved_cs_client;

--
-- Table structure for table `settings`
--

DROP TABLE IF EXISTS `settings`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `settings` (
  `setting` varchar(45) NOT NULL,
  `val` int(11) NOT NULL,
  PRIMARY KEY (`setting`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `settings`
--

LOCK TABLES `settings` WRITE;
/*!40000 ALTER TABLE `settings` DISABLE KEYS */;
INSERT INTO `settings` VALUES ('nextId',36);
/*!40000 ALTER TABLE `settings` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `severity`
--

DROP TABLE IF EXISTS `severity`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `severity` (
  `recordId` int(11) NOT NULL AUTO_INCREMENT,
  `patientId` int(11) NOT NULL,
  `severity` enum('A','B','C','D') NOT NULL,
  `validFrom` datetime NOT NULL,
  `comment` mediumtext,
  `modified` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`recordId`),
  KEY `sevFKpat_idx` (`patientId`),
  CONSTRAINT `sevFKpat` FOREIGN KEY (`patientId`) REFERENCES `patients` (`patientId`) ON DELETE CASCADE ON UPDATE NO ACTION
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `severity`
--

LOCK TABLES `severity` WRITE;
/*!40000 ALTER TABLE `severity` DISABLE KEYS */;
INSERT INTO `severity` VALUES (1,3,'A','2015-05-20 11:33:51','this is a test','2015-05-20 11:33:51'),(2,4,'C','2015-05-19 11:33:51','another test','2015-05-20 11:33:51');
/*!40000 ALTER TABLE `severity` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Temporary table structure for view `severity_view`
--

DROP TABLE IF EXISTS `severity_view`;
/*!50001 DROP VIEW IF EXISTS `severity_view`*/;
SET @saved_cs_client     = @@character_set_client;
SET character_set_client = utf8;
/*!50001 CREATE TABLE `severity_view` (
  `recordId` tinyint NOT NULL,
  `patientId` tinyint NOT NULL,
  `severity` tinyint NOT NULL,
  `validFrom` tinyint NOT NULL,
  `comment` tinyint NOT NULL,
  `modified` tinyint NOT NULL
) ENGINE=MyISAM */;
SET character_set_client = @saved_cs_client;

--
-- Table structure for table `treatments`
--

DROP TABLE IF EXISTS `treatments`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `treatments` (
  `recordId` int(11) NOT NULL AUTO_INCREMENT,
  `patientId` int(11) NOT NULL,
  `diagnoseDate` date DEFAULT NULL,
  `status` enum('baseline','exacerbation') NOT NULL,
  `shortActingB2` tinyint(1) DEFAULT NULL,
  `longActingB2` tinyint(1) DEFAULT NULL,
  `ultraLongB2` tinyint(1) DEFAULT NULL,
  `steroidsInhaled` tinyint(1) DEFAULT NULL,
  `steroidsOral` tinyint(1) DEFAULT NULL,
  `sama` tinyint(1) DEFAULT NULL,
  `lama` tinyint(1) DEFAULT NULL,
  `pdef4Inhalator` tinyint(1) DEFAULT NULL,
  `theophyline` tinyint(1) DEFAULT NULL,
  `mycolytocis` tinyint(1) DEFAULT NULL,
  `antibiotics` tinyint(1) DEFAULT NULL,
  `antiflu` tinyint(1) DEFAULT NULL,
  `antipneum` tinyint(1) DEFAULT NULL,
  `ltot` tinyint(1) DEFAULT NULL,
  `ltotStartDate` date DEFAULT NULL,
  `ltotDevice` enum('none','Cylinder','Liquid','Concetrator') DEFAULT NULL,
  `niv` tinyint(1) DEFAULT NULL,
  `ventilationStart` date DEFAULT NULL,
  `ventilationDevice` enum('none','BiPAP','CPAP') DEFAULT NULL,
  `other` text,
  `modified` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`recordId`),
  KEY `treatFKpat_idx` (`patientId`),
  CONSTRAINT `treatFKpat` FOREIGN KEY (`patientId`) REFERENCES `patients` (`patientId`) ON DELETE CASCADE ON UPDATE NO ACTION
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `treatments`
--

LOCK TABLES `treatments` WRITE;
/*!40000 ALTER TABLE `treatments` DISABLE KEYS */;
INSERT INTO `treatments` VALUES (1,3,'2015-05-18','baseline',1,1,0,1,0,0,1,0,0,0,1,0,0,1,'2015-05-20','Liquid',1,'2015-05-20','CPAP',NULL,'2015-05-20 11:33:51'),(2,4,'2015-05-19','baseline',1,0,1,1,1,0,0,0,1,1,1,0,1,1,'2015-05-20','Liquid',1,'2015-05-20','CPAP',NULL,'2015-05-20 11:33:51');
/*!40000 ALTER TABLE `treatments` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,STRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,TRADITIONAL,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `treatments_BINS` BEFORE INSERT ON `treatments` FOR EACH ROW
begin
if (new.diagnoseDate is null) then set new.diagnoseDate = CURDATE(); end if;
end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,STRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,TRADITIONAL,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `treatments_BUPD` BEFORE UPDATE ON `treatments` FOR EACH ROW
begin
if (new.diagnoseDate is null) then set new.diagnoseDate = CURDATE(); end if;
end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Temporary table structure for view `treatments_view`
--

DROP TABLE IF EXISTS `treatments_view`;
/*!50001 DROP VIEW IF EXISTS `treatments_view`*/;
SET @saved_cs_client     = @@character_set_client;
SET character_set_client = utf8;
/*!50001 CREATE TABLE `treatments_view` (
  `patientId` tinyint NOT NULL,
  `diagnoseDate` tinyint NOT NULL,
  `status` tinyint NOT NULL,
  `shortActingB2` tinyint NOT NULL,
  `longActingB2` tinyint NOT NULL,
  `ultraLongB2` tinyint NOT NULL,
  `steroidsInhaled` tinyint NOT NULL,
  `steroidsOral` tinyint NOT NULL,
  `sama` tinyint NOT NULL,
  `lama` tinyint NOT NULL,
  `pdef4Inhalator` tinyint NOT NULL,
  `theophyline` tinyint NOT NULL,
  `mycolytocis` tinyint NOT NULL,
  `antibiotics` tinyint NOT NULL,
  `antiflu` tinyint NOT NULL,
  `antipneum` tinyint NOT NULL,
  `ltot` tinyint NOT NULL,
  `ltotStartDate` tinyint NOT NULL,
  `ltotDevice` tinyint NOT NULL,
  `niv` tinyint NOT NULL,
  `ventilationStart` tinyint NOT NULL,
  `ventilationDevice` tinyint NOT NULL,
  `recordId` tinyint NOT NULL,
  `other` tinyint NOT NULL,
  `modified` tinyint NOT NULL
) ENGINE=MyISAM */;
SET character_set_client = @saved_cs_client;

--
-- Final view structure for view `accounts_view`
--

/*!50001 DROP TABLE IF EXISTS `accounts_view`*/;
/*!50001 DROP VIEW IF EXISTS `accounts_view`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8 */;
/*!50001 SET character_set_results     = utf8 */;
/*!50001 SET collation_connection      = utf8_general_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`echo_db_usr`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `accounts_view` AS select `accounts`.`accountId` AS `accountId`,`accounts`.`username` AS `username`,`accounts`.`password` AS `password`,`accounts`.`role` AS `role`,`accounts`.`email` AS `email`,`accounts`.`enabled` AS `enabled`,`accounts`.`reminderTime` AS `reminderTime`,`accounts`.`notificationEnabled` AS `notificationEnabled`,`accounts`.`notificationMode` AS `notificationMode`,`accounts`.`mobile` AS `mobile`,`accounts`.`modified` AS `modified` from `accounts` where (case when (`getRole`() = 'admin') then (1 = 1) else (`accounts`.`accountId` = substring_index(user(),'@',1)) end) */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `cats_view`
--

/*!50001 DROP TABLE IF EXISTS `cats_view`*/;
/*!50001 DROP VIEW IF EXISTS `cats_view`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8 */;
/*!50001 SET character_set_results     = utf8 */;
/*!50001 SET collation_connection      = utf8_general_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`echo_db_usr`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `cats_view` AS select `cats`.`recordId` AS `recordId`,`cats`.`patientId` AS `patientId`,`cats`.`diagnoseDate` AS `diagnoseDate`,`cats`.`q1` AS `q1`,`cats`.`q2` AS `q2`,`cats`.`q3` AS `q3`,`cats`.`q4` AS `q4`,`cats`.`q5` AS `q5`,`cats`.`q6` AS `q6`,`cats`.`q7` AS `q7`,`cats`.`q8` AS `q8`,`cats`.`totalCatscale` AS `totalCatscale`,`cats`.`status` AS `status`,`cats`.`modified` AS `modified` from `cats` where (case when (`getRole`() = 'admin') then (1 = 1) else `cats`.`patientId` in (select `patients`.`patientId` from `patients` where (`patients`.`doctorId` = substring_index(user(),'@',1))) end) */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `ccqs_view`
--

/*!50001 DROP TABLE IF EXISTS `ccqs_view`*/;
/*!50001 DROP VIEW IF EXISTS `ccqs_view`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8 */;
/*!50001 SET character_set_results     = utf8 */;
/*!50001 SET collation_connection      = utf8_general_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`echo_db_usr`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `ccqs_view` AS select `ccqs`.`recordId` AS `recordId`,`ccqs`.`patientId` AS `patientId`,`ccqs`.`diagnoseDate` AS `diagnoseDate`,`ccqs`.`q1` AS `q1`,`ccqs`.`q2` AS `q2`,`ccqs`.`q3` AS `q3`,`ccqs`.`q4` AS `q4`,`ccqs`.`q5` AS `q5`,`ccqs`.`q6` AS `q6`,`ccqs`.`q7` AS `q7`,`ccqs`.`q8` AS `q8`,`ccqs`.`q9` AS `q9`,`ccqs`.`q10` AS `q10`,`ccqs`.`totalCCQScore` AS `totalCCQScore`,`ccqs`.`symptomScore` AS `symptomScore`,`ccqs`.`mentalStateScore` AS `mentalStateScore`,`ccqs`.`functionalStateScore` AS `functionalStateScore`,`ccqs`.`status` AS `status`,`ccqs`.`modified` AS `modified` from `ccqs` where (case when (`getRole`() = 'admin') then (1 = 1) else `ccqs`.`patientId` in (select `patients`.`patientId` from `patients` where (`patients`.`doctorId` = substring_index(user(),'@',1))) end) */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `charlsons_view`
--

/*!50001 DROP TABLE IF EXISTS `charlsons_view`*/;
/*!50001 DROP VIEW IF EXISTS `charlsons_view`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8 */;
/*!50001 SET character_set_results     = utf8 */;
/*!50001 SET collation_connection      = utf8_general_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`echo_db_usr`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `charlsons_view` AS select `charlsons`.`recordId` AS `recordId`,`charlsons`.`patientId` AS `patientId`,`charlsons`.`diagnoseDate` AS `diagnoseDate`,`charlsons`.`myocardialInfarction` AS `myocardialInfarction`,`charlsons`.`congestiveHeartFailure` AS `congestiveHeartFailure`,`charlsons`.`peripheralVascularDisease` AS `peripheralVascularDisease`,`charlsons`.`cerebrovascularDisease` AS `cerebrovascularDisease`,`charlsons`.`dementia` AS `dementia`,`charlsons`.`chronicPulmonaryDiasease` AS `chronicPulmonaryDiasease`,`charlsons`.`connectiveTissueDisease` AS `connectiveTissueDisease`,`charlsons`.`ulcerDisease` AS `ulcerDisease`,`charlsons`.`liverDiseaseMild` AS `liverDiseaseMild`,`charlsons`.`diabetes` AS `diabetes`,`charlsons`.`hemiplegia` AS `hemiplegia`,`charlsons`.`renalDiseaseModerateOrSevere` AS `renalDiseaseModerateOrSevere`,`charlsons`.`diabetesWithEndOrganDamage` AS `diabetesWithEndOrganDamage`,`charlsons`.`anyTumor` AS `anyTumor`,`charlsons`.`leukemia` AS `leukemia`,`charlsons`.`malignantLymphoma` AS `malignantLymphoma`,`charlsons`.`liverDiseaseModerateOrSevere` AS `liverDiseaseModerateOrSevere`,`charlsons`.`metastaticSolidMalignancy` AS `metastaticSolidMalignancy`,`charlsons`.`aids` AS `aids`,`charlsons`.`noConditionAvailable` AS `noConditionAvailable`,`charlsons`.`totalCharlson` AS `totalCharlson`,`charlsons`.`modified` AS `modified` from `charlsons` where (case when (`getRole`() = 'admin') then (1 = 1) else `charlsons`.`patientId` in (select `patients`.`patientId` from `patients` where (`patients`.`doctorId` = substring_index(user(),'@',1))) end) */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `dailyReports_view`
--

/*!50001 DROP TABLE IF EXISTS `dailyReports_view`*/;
/*!50001 DROP VIEW IF EXISTS `dailyReports_view`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8 */;
/*!50001 SET character_set_results     = utf8 */;
/*!50001 SET collation_connection      = utf8_general_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`echo_db_usr`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `dailyReports_view` AS select `dailyReports`.`recordId` AS `recordId`,`dailyReports`.`patientId` AS `patientId`,`dailyReports`.`date` AS `date`,`dailyReports`.`q1` AS `q1`,`dailyReports`.`q2` AS `q2`,`dailyReports`.`q3` AS `q3`,`dailyReports`.`q4` AS `q4`,`dailyReports`.`q5` AS `q5`,`dailyReports`.`q1a` AS `q1a`,`dailyReports`.`q1b` AS `q1b`,`dailyReports`.`q1c` AS `q1c`,`dailyReports`.`q3a` AS `q3a`,`dailyReports`.`q3b` AS `q3b`,`dailyReports`.`q3c` AS `q3c`,`dailyReports`.`satO2` AS `satO2`,`dailyReports`.`walkingDist` AS `walkingDist`,`dailyReports`.`temperature` AS `temperature`,`dailyReports`.`pefr` AS `pefr`,`dailyReports`.`heartRate` AS `heartRate`,`dailyReports`.`loc` AS `loc`,`dailyReports`.`modified` AS `modified` from `dailyReports` where (case when (`GETROLE`() = 'admin') then (1 = 1) when (`GETROLE`() = 'doctor') then `dailyReports`.`patientId` in (select `patients`.`patientId` from `patients` where (`patients`.`doctorId` = substring_index(user(),'@',1))) else (`dailyReports`.`patientId` = substring_index(user(),'@',1)) end) */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `deaths_view`
--

/*!50001 DROP TABLE IF EXISTS `deaths_view`*/;
/*!50001 DROP VIEW IF EXISTS `deaths_view`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8 */;
/*!50001 SET character_set_results     = utf8 */;
/*!50001 SET collation_connection      = utf8_general_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`echo_db_usr`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `deaths_view` AS select `deaths`.`patientId` AS `patientId`,`deaths`.`date` AS `date`,`deaths`.`cardiovascular` AS `cardiovascular`,`deaths`.`respiratory` AS `respiratory`,`deaths`.`infectious_disease` AS `infectious_disease`,`deaths`.`malignancy` AS `malignancy`,`deaths`.`other` AS `other`,`deaths`.`modified` AS `modified` from `deaths` where (case when (`getRole`() = 'admin') then (1 = 1) else `deaths`.`patientId` in (select `patients`.`patientId` from `patients` where (`patients`.`doctorId` = substring_index(user(),'@',1))) end) */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `notifications_view`
--

/*!50001 DROP TABLE IF EXISTS `notifications_view`*/;
/*!50001 DROP VIEW IF EXISTS `notifications_view`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8 */;
/*!50001 SET character_set_results     = utf8 */;
/*!50001 SET collation_connection      = utf8_general_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`echo_db_usr`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `notifications_view` AS select `n`.`notificationId` AS `notificationId`,`n`.`accountId` AS `accountId`,`n`.`date` AS `date`,`n`.`type` AS `type`,`n`.`subjectsAccount` AS `subjectsAccount`,(case `n`.`type` when 0 then 'Please fill in your daily report.' when 1 then 'Call your doctor!' when 2 then 'Go to the hospital!' when 3 then concat('Your patient ',`p`.`firstName`,' ',`p`.`lastName`,' should call you') when 4 then concat('Your patient ',`p`.`firstName`,' ',`p`.`lastName`,' should go to the hospital') when 5 then concat('Your patient ',`p`.`firstName`,' ',`p`.`lastName`,' hasnt filled in his report for 2 days') when 6 then concat('Your patient ',`p`.`firstName`,' ',`p`.`lastName`,' hasnt filled in his report for 10 days') else '' end) AS `message`,`n`.`modified` AS `modified` from (`notifications` `n` left join `patients` `p` on((`n`.`subjectsAccount` = `p`.`patientId`))) where (`n`.`accountId` = substring_index(user(),'@',1)) */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `patients_view`
--

/*!50001 DROP TABLE IF EXISTS `patients_view`*/;
/*!50001 DROP VIEW IF EXISTS `patients_view`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8 */;
/*!50001 SET character_set_results     = utf8 */;
/*!50001 SET collation_connection      = utf8_general_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`echo_db_usr`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `patients_view` AS select `patients`.`patientId` AS `patientId`,`patients`.`doctorId` AS `doctorId`,`patients`.`firstName` AS `firstName`,`patients`.`lastName` AS `lastName`,`patients`.`secondName` AS `secondName`,`patients`.`socialId` AS `socialId`,`patients`.`sex` AS `sex`,`patients`.`dateOfBirth` AS `dateOfBirth`,`patients`.`firstDiagnoseDate` AS `firstDiagnoseDate`,`patients`.`fileId` AS `fileId`,`patients`.`fullAddress` AS `fullAddress`,`patients`.`landline` AS `landline`,`accounts`.`enabled` AS `enabled`,`accounts`.`email` AS `email`,`accounts`.`mobile` AS `mobile`,`patients`.`modified` AS `modified`,(select `severity`.`severity` AS `severity` from `severity` where (`severity`.`patientId` = `accounts`.`accountId`) order by `severity`.`validFrom` desc limit 1) AS `severity` from (`patients` join `accounts` on((`patients`.`patientId` = `accounts`.`accountId`))) where (case when (`getRole`() = 'admin') then (1 = 1) else ((`patients`.`patientId` = `accounts`.`accountId`) and (`patients`.`doctorId` = substring_index(user(),'@',1))) end) */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `readings_view`
--

/*!50001 DROP TABLE IF EXISTS `readings_view`*/;
/*!50001 DROP VIEW IF EXISTS `readings_view`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8 */;
/*!50001 SET character_set_results     = utf8 */;
/*!50001 SET collation_connection      = utf8_general_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`echo_db_usr`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `readings_view` AS select `readings`.`patientId` AS `patientId`,`readings`.`diagnoseDate` AS `diagnoseDate`,`readings`.`weight` AS `weight`,`readings`.`height` AS `height`,`readings`.`pxy` AS `pxy`,`readings`.`fev1` AS `fev1`,`readings`.`fev1_pro` AS `fev1_pro`,`readings`.`fvc` AS `fvc`,`readings`.`fvc_pro` AS `fvc_pro`,`readings`.`fev1_fvc` AS `fev1_fvc`,`readings`.`rv` AS `rv`,`readings`.`rv_pro` AS `rv_pro`,`readings`.`tlc` AS `tlc`,`readings`.`tlc_pro` AS `tlc_pro`,`readings`.`rv_tlc` AS `rv_tlc`,`readings`.`satO2_pro` AS `satO2_pro`,`readings`.`dlco_pro` AS `dlco_pro`,`readings`.`pao2` AS `pao2`,`readings`.`paco2` AS `paco2`,`readings`.`hco3` AS `hco3`,`readings`.`pH` AS `pH`,`readings`.`fvc_pre` AS `fvc_pre`,`readings`.`fvc_pre_pro` AS `fvc_pre_pro`,`readings`.`fev1_pre` AS `fev1_pre`,`readings`.`fev1_pre_pro` AS `fev1_pre_pro`,`readings`.`fev1_fvc_pre` AS `fev1_fvc_pre`,`readings`.`fef25_75_pre_pro` AS `fef25_75_pre_pro`,`readings`.`pef_pre_pro` AS `pef_pre_pro`,`readings`.`tlc_pre` AS `tlc_pre`,`readings`.`tlc_pre_pro` AS `tlc_pre_pro`,`readings`.`frc_pre` AS `frc_pre`,`readings`.`frc_pre_pro` AS `frc_pre_pro`,`readings`.`rv_pre` AS `rv_pre`,`readings`.`rv_pre_pro` AS `rv_pre_pro`,`readings`.`kco_pro` AS `kco_pro`,`readings`.`hematocrit` AS `hematocrit`,`readings`.`status` AS `status`,`readings`.`fvc_post` AS `fvc_post`,`readings`.`del_fvc_pro` AS `del_fvc_pro`,`readings`.`fev1_post` AS `fev1_post`,`readings`.`del_fev1_post` AS `del_fev1_post`,`readings`.`del_fef25_75_pro` AS `del_fef25_75_pro`,`readings`.`del_pef_pro` AS `del_pef_pro`,`readings`.`mmrc` AS `mmrc`,`readings`.`smoker` AS `smoker`,`readings`.`notes` AS `notes`,`readings`.`recordId` AS `recordId`,`readings`.`modified` AS `modified` from `readings` where (case when (`getRole`() = 'admin') then (1 = 1) else `readings`.`patientId` in (select `patients`.`patientId` from `patients` where (`patients`.`doctorId` = substring_index(user(),'@',1))) end) */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `severity_view`
--

/*!50001 DROP TABLE IF EXISTS `severity_view`*/;
/*!50001 DROP VIEW IF EXISTS `severity_view`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8 */;
/*!50001 SET character_set_results     = utf8 */;
/*!50001 SET collation_connection      = utf8_general_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`echo_db_usr`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `severity_view` AS select `severity`.`recordId` AS `recordId`,`severity`.`patientId` AS `patientId`,`severity`.`severity` AS `severity`,`severity`.`validFrom` AS `validFrom`,`severity`.`comment` AS `comment`,`severity`.`modified` AS `modified` from `severity` where (case when (`getRole`() = 'admin') then (1 = 1) else `severity`.`patientId` in (select `patients`.`patientId` from `patients` where (`patients`.`doctorId` = substring_index(user(),'@',1))) end) */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `treatments_view`
--

/*!50001 DROP TABLE IF EXISTS `treatments_view`*/;
/*!50001 DROP VIEW IF EXISTS `treatments_view`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8 */;
/*!50001 SET character_set_results     = utf8 */;
/*!50001 SET collation_connection      = utf8_general_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`echo_db_usr`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `treatments_view` AS select `treatments`.`patientId` AS `patientId`,`treatments`.`diagnoseDate` AS `diagnoseDate`,`treatments`.`status` AS `status`,`treatments`.`shortActingB2` AS `shortActingB2`,`treatments`.`longActingB2` AS `longActingB2`,`treatments`.`ultraLongB2` AS `ultraLongB2`,`treatments`.`steroidsInhaled` AS `steroidsInhaled`,`treatments`.`steroidsOral` AS `steroidsOral`,`treatments`.`sama` AS `sama`,`treatments`.`lama` AS `lama`,`treatments`.`pdef4Inhalator` AS `pdef4Inhalator`,`treatments`.`theophyline` AS `theophyline`,`treatments`.`mycolytocis` AS `mycolytocis`,`treatments`.`antibiotics` AS `antibiotics`,`treatments`.`antiflu` AS `antiflu`,`treatments`.`antipneum` AS `antipneum`,`treatments`.`ltot` AS `ltot`,`treatments`.`ltotStartDate` AS `ltotStartDate`,`treatments`.`ltotDevice` AS `ltotDevice`,`treatments`.`niv` AS `niv`,`treatments`.`ventilationStart` AS `ventilationStart`,`treatments`.`ventilationDevice` AS `ventilationDevice`,`treatments`.`recordId` AS `recordId`,`treatments`.`other` AS `other`,`treatments`.`modified` AS `modified` from `treatments` where (case when (`getRole`() = 'admin') then (1 = 1) else `treatments`.`patientId` in (select `patients`.`patientId` from `patients` where (`patients`.`doctorId` = substring_index(user(),'@',1))) end) */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2015-05-26 16:37:00
