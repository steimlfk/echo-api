/**
 * Created by armin on 25.03.15.
 */
var commons = require('./controller_commons');

exports.list = function(req, res, next) {
    commons.list(req,res,next,'severity');
};

exports.listOne = function(req, res, next) {
    commons.listOne(req, res, next, 'severity');
};

exports.del = function(req,res,next){
    commons.del(req,res,next,'severity');
};

exports.add = function(req,res,next){
    var connection = req.con;
    // 4) create SQL Query from parameters
    var i = req.body;
    // any given ID in the body will be ignored and the ids from the url are used!
    var id = parseInt(req.params.id);
    // if no date is given make it null, so the trigger can set the date
    var date = i.validFrom || null;
    // if no comment is given make it null.
    var comment = i.comment || null;
    // query db
    // ? from query will be replaced by values in [] - including escaping!
    connection.query('call severityCreate(?,?,?,?)',
        [id, date,comment, i.severity.toUpperCase()],
        function(err, result) {
            if (err) {
                next(err);

            } else {
                // resource was created
                // link will be provided in location header
                res.statusCode = 201;
                res.location('/patients/'+ id + '/severities/' + result[0][0].insertId);
                res.send();
            }
            connection.release();
        });
};